# 火山方舟分账最佳实践
使用火山方舟大模型服务的客户，尤其是企业级客户，普遍存在强烈的分账诉求。例如：通过分账实现大模型服务成本精准核算、业务绩效评估及内部责任划分等。若想做好分账管理，通常在使用大模型前就需要做好内部设计，例如：分账维度梳理、分摊规则定义等。本文将火山方舟支持的分账场景做了典型梳理，沉淀了常见场景的分账解决方案和操作方法，助企业高效落地分账。
:::tip
每个场景都是一个独立的解决方案。其中，场景1、2、3可叠加使用，满足复杂的企业级分账场景。
:::
# 分账概述
## 什么是分账
分账是指将已经明确的账单数据，依据用户企业内部的实际使用情况或用户自身的业务逻辑，进行账单数据的拆分。分配至不同的业务，部门，甚至个人等。通俗来说，就是通过分账体现出谁在什么产品或者服务上花了多少钱。
## 支持的分账维度
![Image](https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/1bae449f72ed426487498a5e8d2098cf~tplv-goo7wpa0wc-image.image =1982x)

1. **账号（对应下文场景1）**：账号间的资源隔离，资源归属不同，天然具备分账的能力。用户可以根据业务情况，将不同的部门或不同的业务线独立使用不同的账号进行资源和费用划分，分别各自管理资源和账单，也可通过企业财务能力集中管理费用。
2. **项目（对应下文场景2）**：在单一账号下，单个资源（接入点）可关联唯一项目，如上图 Account_02 所示。当资源产生费用时，会根据资源所属的项目，将费用也自动归属到对应项目中，得到按项目维度的分账数据。
3. **标签（对应下文场景3）**：在单一项目中，单个资源（接入点）可关联多个标签，如上图 Account_02 中的项目 02 所示。标签可标记资源的详细信息，当资源产生费用时，会根据资源所绑定的标签，将费用也自动关联到标签上，得到按标签维度的分账数据。
4. **配置名称/计费单元（对应下文场景4）**：配置名称和计费单元记录了用户使用大模型时所选择的模型和具体计费项目，可以按照配置名称&计费单元进行分组求和，得到模型和模型中计费项目的具体费用，如上图 Account_01 所示。
5. **createdBy系统标签（对应下文场景5）**：在标签系统中，有一类由系统自动创建的标签，典型的就是创建者标签createdBy。当用户开通该功能时，无论使用何种身份登录账号创建资源，系统都会自动在资源上标记该用户的登录身份信息，记录该资源的创建者，如上图 Account_02 中的项目 03 所示。我们可以利用该标签的内容，来得到创建者维度的分账数据。
6. **API Key**：规划中，敬请期待。

# 准备工作

1. [开通分账账单功能](https://console.volcengine.com/finance/bill/split-bill)。

:::warning
开通分账账单功能后产生的消费，才能查询到分账账单。请务必提前开通分账账单功能！
:::
# 场景1：多部门分账
## 场景描述
某个公司主体采购了方舟的一个或多个模型服务，多个部门同时使用这些模型服务，需要按照部门维度进行账单统计。
## 解决方案
选择一个火山引擎账号作为财务托管（托管账号，又称托管主账号），管理各部门账号（被托管账号，又称托管子账号）的财务履约。各部门账号仅可查看自己消费的账单，账单结算、开票、还款均由托管主账号负责。托管主账号可通过账号维度查看各部门产生的账单。

1. 企业下每个部门独立使用一个火山引擎账号，托管子账号可由托管主账号协助申请，无需重复实名认证。
2. 财务部门账号作为托管主账号，在[费用中心 > 财务关联](https://console.volcengine.com/finance/business-finance/relation)页面，邀请其他账号完成财务托管关联。操作步骤详见 [财务托管关联和解除](https://www.volcengine.com/docs/6269/110618#.6LSi5Yqh5omY566h5YWz6IGU5pON5L2c6K-05piO)。

## 查询账单
使用托管主账号登录，在[分账账单](https://console.volcengine.com/finance/bill/split-bill)页面， 默认展示当前主账号（Payer 账号）下的所有子账号（Owner 账号）的消费账单。您也可以过滤要查询的 Owner 账号，查询目标子账号的消费账单。
<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/d32c20feaf7b427ca3509aa8e45d4ec1~tplv-goo7wpa0wc-image.image" width="1668px" /></div>

# 场景2：多项目组分账
## 场景描述
某个部门采购了一个或多个模型服务，部门中的多个项目组同时使用这些模型服务，需要按项目维度进行账单统计。
## 解决方案
每个项目组创建一个项目，创建推理接入点时选择归属的项目。查询账单时，通过项目分组求和。

1. [规划并创建项目](https://console.volcengine.com/iam/resourcemanage/project)。每个项目组创建一个单独的项目。
2. [规划并创建推理接入点](https://console.volcengine.com/ark/region:ark+cn-beijing/endpoint?config=%7B%7D)。每个项目，按需创建一个或多个推理接入点，创建推理接入点时选择归属的项目。

<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/a0eec96db78746c491e38f0764ca6be7~tplv-goo7wpa0wc-image.image" width="1433px" /></div>

## 查询账单

1. 在[分账账单](https://console.volcengine.com/finance/bill/split-bill)页面，选择目标项目，过滤要查询的产品，即可查询某个项目下的消费账单。

<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/c2b4afbebd3b4258a1c5430d5eb0c16a~tplv-goo7wpa0wc-image.image" width="1684px" /></div>

2. 单击右上角 **查询项目汇总分布**，可查看当前账号下不同项目的总消费账单。

# 场景3：多产品分账
## 场景描述
某个项目组采购了一个或多个模型服务，项目组下包含多个应用、多个产品、多个环境（开发环境、测试环境、生产环境）等，需要按应用/产品/环境进行账单统计。
## 解决方案
每个项目组创建一个项目，创建推理接入点时选择归属的项目，并打上应用的标签。查询账单时，通过标签分组求和。
以某项目组下包含开发、测试、生产环境为例。

1. [创建项目](https://console.volcengine.com/iam/resourcemanage/project)。
2. [规划并创建标签](https://console.volcengine.com/resourcemanager/tag/list)。

<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/aea4654669644225ac4a310628d01eb9~tplv-goo7wpa0wc-image.image" width="598px" /></div>

3. [启用费用标签key](https://console.volcengine.com/finance/bill/tag)。确保该费用标签key在账单明细等数据中体现。
4. [创建推理接入点](https://console.volcengine.com/ark/region:ark+cn-beijing/endpoint?config=%7B%7D)。每个环境创建一个推理接入点，并选择归属的项目和标签。

<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/ce7f5d5e5c9c452688bde71e5a478f30~tplv-goo7wpa0wc-image.image" width="1406px" /></div>

<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/a663d8b005884c9eb313efd9258057bf~tplv-goo7wpa0wc-image.image" width="1603px" /></div>

## 查询账单
在[分账账单](https://console.volcengine.com/finance/bill/split-bill)页面，选择目标项目和标签，过滤要查询的产品，即可查询某个项目下的消费账单。
<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/0e8471b84db940e9a3a9a5be090b5787~tplv-goo7wpa0wc-image.image" width="1691px" /></div>

# 场景4：多模型分账（简单场景）
## 场景描述
公司或个人采购了多个模型服务，需要按不同模型进行账单统计。适用于不希望引入自定义推理接入点，希望直接通过 Model ID 调用的场景。
## 解决方案
按配置名称/计费单元分账。

* 按配置名称分账：

火山方舟平台，配置名称通常对应某个模型的所有后付费计费项。当前分账账单页面暂不支持按配置名称进行筛选。您可以通过[API接口](https://api.volcengine.com/api-explorer?action=ListSplitBillDetail&groupName=%E8%B4%A6%E5%8D%95%E4%B8%AD%E5%BF%83&serviceCode=billing&version=2022-01-01)拉取分账账单数据，按 ConfigName 进行分组求和。

* 按计费单元分账：

能统计到某个模型的某个计费项的花费。例如：统计某模型的缓存命中费用，了解使用缓存后节省了多少成本。
## 查询账单
在[分账账单](https://console.volcengine.com/finance/bill/split-bill)页面，统计周期选择 **明细**，过滤要查询的产品和计费单元，即可查询某个计费项的消费账单。
<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/f540b21182384bb38420c15b577f23c5~tplv-goo7wpa0wc-image.image" width="1670px" /></div>

# 场景5：多人分账（简单场景）
## 场景描述
公司采购了一个或多个模型服务，多人同时使用这些模型服务，需要按人头进行账单统计。
## 解决方案
每个 IAM 用户按需创建多个推理接入点，这些推理接入点会自动绑定createdBy系统标签（sys:ark:createdBy : IAMUser/xxx）。查询账单时，按照 IAMUser 进行分组求和。

1. [启用创建者标签](https://console.volcengine.com/resourcemanager/tag/create_by)。
2. [启用费用标签key](https://console.volcengine.com/finance/bill/tag)。确保该费用标签key `sys:ark:createdBy`在账单明细等数据中体现。
3. [创建推理接入点](https://console.volcengine.com/ark/region:ark+cn-beijing/endpoint?config=%7B%7D)。每个 IAM 用户按需创建多个推理接入点。

## 查询账单
在[分账账单](https://console.volcengine.com/finance/bill/split-bill)页面，统计周期选择 **明细**，标签选择目标 IAMUser，即可按照人头查询账单。
<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/72d957a1f41d47a69c9de1f68914db0e~tplv-goo7wpa0wc-image.image" width="1702px" /></div>

# 常见问题
## 什么是推理接入点? 有什么作用？
在使用大语言模型进行推理服务时，推理接入点（Endpoint）是模型调用的关键入口。开发者只需通过指定的 ID 即可向大模型发起 API / SDK 推理请求，实现快速接入与灵活调用。推理接入点分为预置推理接入点和自定义推理接入点。用户主动创建的推理接入点为自定义推理接入点，支持更全面的配置能力，适用于需要精调模型接入、权限控制（配置项目和标签）、算力保障、数据回流等企业级或业务集成场景。更多详情请参见 [什么是推理接入点](https://www.volcengine.com/docs/82379/1544856)。
## 什么是财务托管？有什么作用？
财务托管，即账号授权其他账号对其云资源消费产生的账单进行托管，并负责后续的对账、开票、还款等履约内容。托管主账号(托管账号)管理托管子账号(被托管账号)的财务履约，托管子账号(被托管账号)只有资源操作的权限。在企业财务中，托管账号在关联被托管账户时可以设置关系类型为“财务托管”，即实现被托管账号的财务履约内容托管给托管账号来进行管理。更多详情请参见 [财务托管概述](https://www.volcengine.com/docs/6269/110617)。
## 什么是项目？有什么作用？
资源项目（项目）是火山引擎提供的一种资源分组管理的机制，帮助达成逻辑层面的资源隔离，您能够通过资源项目进行项目制授权和分账等操作。更多详情请参见 [项目概述](https://www.volcengine.com/docs/6649/189152)。
## 什么是标签？有什么作用？
资源标签是由一组KV键值对组成，您可以通过资源标签从不同维度对云资源进行分类和聚合管理，并且使用于标签制授权和标签分账等场景。更多详情请参见 [标签概述](https://www.volcengine.com/docs/6649/189377)。
## 如何快速查看某个推理接入点的费用？
在方舟控制台的[在线推理](https://console.volcengine.com/ark/region:ark+cn-beijing/endpoint?config=%7B%7D)页面，切换至 **自定义推理接入点** 页签，单击目标推理接入点名称，进入 **概览信息** 页面。单击 **前往查看账单**，即可跳转至分账账单页面查看该推理接入点的账单信息。
<div style="text-align: center"><img src="https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/14ba908f225d493096003707cf4b74fa~tplv-goo7wpa0wc-image.image" width="2422px" /></div>